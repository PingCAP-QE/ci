# Error Log Review Configuration Example
# This is an example configuration file showing how to configure
# error log pattern detection and approval requirements.

# Repository configurations
repositories:
  # Example Go project configuration
  - name: "pingcap/tidb"
    patterns:
      # Pattern to match string literals in log statements
      - name: "string_literals"
        description: "Pattern for string literals in Go logging"
        regex: '(?:^|\s)(?:(?:[^)]+\.)?(?:log|logutil|logger|brlog)(?:\.(?:L\(\)|CL\([^)]*\)|FromContext\([^)]*\)|Logger\([^)]*\)|[A-Za-z]+Logger\([^)]*\))\)?)?)\.(Error|Panic|Fatal|Fatalf|Fatalln)\([^"]*"([^"]+)"[^)]*\)'
        # Optional: Exclude specific paths from this pattern (glob patterns)
        excludes:
          - "tests/**"           # Exclude all files under tests/ directory
          - "*_test.go"          # Exclude all Go test files
          - "examples/**"        # Exclude all files under examples/ directory

      # Pattern to match variables and function calls in log statements
      - name: "variables_and_functions"
        description: "Pattern for variables and function calls in Go logging"
        regex: '(?:^|\s)(?:(?:[^)]+\.)?(?:log|logutil|logger|brlog)(?:\.(?:L\(\)|CL\([^)]*\)|FromContext\([^)]*\)|Logger\([^)]*\)|[A-Za-z]+Logger\([^)]*\))\)?)?)\.(Error|Panic|Fatal|Fatalf|Fatalln)\(\s*([^,)]+?)(?:\s*,\s*[^)]+?)?\s*\)'
        # This pattern doesn't have excludes, so it applies to all files

    # List of GitHub usernames who can approve error log changes for this repository
    approvers:
      - "maintainer1"
      - "maintainer2"
      - "security-team-lead"

    # Optional: Global excludes for all patterns in this repository
    # These work in addition to pattern-specific excludes
    # excludes:
    #   - "vendor/**"
    #   - "third_party/**"

  # Example Rust project configuration
  - name: "tikv/tikv"
    patterns:
      # Pattern to match string literals in Rust error! macro
      - name: "string_literals"
        description: "Pattern for string literals in Rust error! macro"
        regex: '(?:^|\s)error![^"]*"([^"]+)"[^)]*'

      # Pattern to match variables in Rust error! macro
      - name: "error_variables"
        description: "Pattern for error variables in Rust error! macro"
        regex: '(?:^|\s)error!\s*(\?%?\w+(?:\s*,\s*[^)]*)?)'

    approvers:
      - "rust-maintainer1"
      - "rust-maintainer2"

# Global settings that apply to all repositories
settings:
  # Minimum number of approvals required from the approvers list
  min_approvals: 1

  # Whether to require approval only from repository-specific approvers
  # If true, only users listed in the repository's approvers list can approve
  # If false, any approval comment will be accepted
  require_repo_specific_approvers: true

  # Check behavior configuration
  check_behavior:
    # How to handle error log detection results
    # "check_and_fail" - Check for existing approval, fail if not found
    # "check_and_warn" - Check and log warning, but don't fail the check
    mode: "check_and_fail"

  # Optional: A hint message printed when approval is required.
  # This can include pointers to where to update patterns and approvers.
  # For example: "Edit configs/error-log-review/config.yaml under the corresponding repository to update patterns/approvers."
  hint: "Update error log patterns/approvers at https://github.com/PingCAP-QE/ci/blob/main/configs/error-log-review/config.yaml"
