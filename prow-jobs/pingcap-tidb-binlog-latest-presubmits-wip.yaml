# struct ref: https://pkg.go.dev/k8s.io/test-infra/prow/config#Presubmit
presubmits:
  pingcap/tidb-binlog:
    - name: wip-pull-unit-test
      cluster: gcp-prow-ksyun
      decorate: true # need add this.
      always_run: false # debug
      # skip_if_only_changed: "(\\.md|Dockerfile|OWNERS|OWNERS_ALIASES)$"
      context: wip/pull-unit-test
      branches:
        - ^master$
        - ^feature[_/].+
      spec:
        containers:
          - image: hub.pingcap.net/ee/ci/base:v20230629-go1.20.5          
            command: [bash, -c]
            args:             
              - |
                make test
                codecov -Z -F unit -f /tmp/tidb_binlog_test//cov.unit.out
            env:
              - name: CODECOV_TOKEN
                valueFrom:
                  secretKeyRef:
                    name: codecov-token
                    key: pingcap-tidb-binlog # format <ORG>-<REPO>
