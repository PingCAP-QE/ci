# struct ref: https://pkg.go.dev/k8s.io/test-infra/prow/config#Periodic
periodics:
  - name: pingcap/tidb/latest/periodics_integration_test
    agent: jenkins
    labels:
      master: "0" # Jenkins master instance to run this job (0 = default master)
    decorate: false
    cron: "0 * * * *" # every hour
    extra_refs: # Periodic job doesn't clone any repo by default, needs to be added explicitly
      - org: pingcap
        repo: tidb
        base_ref: master

  - name: periodic-daily-tidb-unit-test
    decorate: true # need add this.
    cron: "0 0 1 * *" # monthly
    agent: kubernetes
    cluster: default
    extra_refs: # Periodic job doesn't clone any repo by default, needs to be added explicitly
      - org: pingcap
        repo: tidb
        base_ref: master
        skip_submodules: true
        clone_depth: 1
    spec:
      containers:
        - name: check
          image: ghcr.io/pingcap-qe/ci/base:v2025.11.30-5-gd8d742b-go1.25
          command: [bash, -ce]
          args:
            - |
              git log -1
              COMMIT_SHA=$(git rev-parse HEAD)
              TIMEZONES=(
                  "Pacific/Honolulu"     # UTC -10:00
                  "America/Anchorage"    # UTC -09:00
                  "America/Los_Angeles"  # UTC -08:00
                  "America/Phoenix"      # UTC -07:00
                  "America/Chicago"      # UTC -06:00
                  "America/New_York"     # UTC -05:00
                  "America/Caracas"      # UTC -04:30
                  "America/Argentina/Buenos_Aires" # UTC -03:00
                  "America/St_Johns"     # UTC -02:30
                  "Atlantic/Azores"      # UTC -01:00
                  "Europe/London"        # UTCÂ±00:00
                  "Europe/Paris"         # UTC +01:00
                  "Africa/Cairo"         # UTC +02:00
                  "Asia/Jerusalem"       # UTC +03:00
                  "Asia/Tehran"          # UTC +03:30
                  "Asia/Dubai"           # UTC +04:00
                  "Asia/Kabul"           # UTC +04:30
                  "Asia/Karachi"         # UTC +05:00
                  "Asia/Kolkata"         # UTC +05:30
                  "Asia/Kathmandu"       # UTC +05:45
                  "Asia/Dhaka"           # UTC +06:00
                  "Asia/Rangoon"         # UTC +06:30
                  "Asia/Jakarta"         # UTC +07:00
                  "Asia/Hong_Kong"       # UTC +08:00
                  "Asia/Tokyo"           # UTC +09:00
                  "Australia/Adelaide"   # UTC +09:30
                  "Australia/Brisbane"   # UTC +10:00
                  "Australia/Lord_Howe"  # UTC +10:30
                  "Pacific/Noumea"       # UTC +11:00
                  "Pacific/Norfolk"      # UTC +11:30
                  "Pacific/Tarawa"       # UTC +12:00
                  "Pacific/Chatham"      # UTC +12:45
                  "Pacific/Apia"         # UTC +13:00
                  "Pacific/Kiritimati"   # UTC +14:00
              )
              RANDOM_TZ=${TIMEZONES[$RANDOM % ${#TIMEZONES[@]}]}
              export TZ=$RANDOM_TZ
              echo $TZ
              echo ""
              make gotest_in_verify_ci

              # upload coverage report
              # wget -q -O codecov https://uploader.codecov.io/v0.5.0/linux/codecov
              # chmod +x codecov
              # ./codecov --flags unit --file test_coverage/tidb_cov.unit_test.out --sha ${COMMIT_SHA} --slug pingcap/tidb
          resources:
            limits:
              memory: 24Gi
              cpu: "12"

  - name: periodic-daily-tidb-long-unit-test
    decorate: true # need add this.
    cron: "0 0 1 * *" # monthly
    agent: kubernetes
    cluster: default
    extra_refs: # Periodic job doesn't clone any repo by default, needs to be added explicitly
      - org: pingcap
        repo: tidb
        base_ref: master
        skip_submodules: true
        clone_depth: 1
    spec:
      containers:
        - name: check
          image: ghcr.io/pingcap-qe/ci/base:v2025.11.30-5-gd8d742b-go1.25
          command: [bash, -ce]
          args:
            - |
              git log -1
              make ut-long
          resources:
            limits:
              memory: 12Gi
              cpu: "6"
