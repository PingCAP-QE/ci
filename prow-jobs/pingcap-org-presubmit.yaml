presubmits:
  PingCAP-QE/ci:
    - name: pull-auto-label
      decorate: true # need add this.
      decoration_config:
        skip_cloning: true
      skip_report: true
      optional: true
      branches:
        - ^main$
      spec:
        nodeSelector:
          kubernetes.io/arch: amd64
        containers:
          - name: ghcli
            image: maniator/gh:latest
            command: [sh, -exec]
            volumeMounts:
              - name: ghtoken
                mountPath: /share/ghtoken
                subPath: token
                readOnly: true
            args:
              - |
                gh auth login --with-token < /share/ghtoken
                gh pr edit https://github.com/${REPO_OWNER}/${REPO_NAME}/pull/${PULL_NUMBER} --add-label "ok-to-test" --remove-label "needs-ok-to-test"
            resources:
              limits:
                memory: 1Gi
                cpu: "500m"
        volumes:
          - name: ghtoken
            secret:
              secretName: ghtoken
